# flex Notes

flex generates a C (C++ compatible) lexical analyzer based on a description of the token patters to match and the code to execute when matches happen. It's a FOSS version of lex, developed separately from lex starting in about 1987 to get around the proprietary nature of lex and also to offer better performance.
> By the way, Eric Schmidt was co-author of the original lex program when he was an intern at Bell Labs back in 1975. He later became CEO of Google and (as of August 2023) was the 82rd richest person in the world. It's pretty clear therefore that compiler work can make one a billionaire so this class is totally worth it. :)

An analyzer generated by flex scans the incoming characters using a Deterministic Finite Automaton created from all of the Regular Expression patterns given in the original description. Thus, in general a flex generated lexical analyzer achieves O(n) time complexity on matching, where n is the number of characters in the input stream.
> NB. If one uses the REJECT capability of flex (a way to force the DFA to “try again” on a match that has already been made), greater than linear time complexity could result.

**A Note on Versions**

flex is remarkably stable — unlike a lot of crappy code that gets released nowadays.

Consequently, flex doesn't need to be released all that often as it does what it does quite well. Having said that, though, you should be using the most recent version 2.6.4 , released 2017- May-06 . That's more than six years ago so there's no excuse not to have it.

I have in the past received some questions from students re: warnings / errors from flex and in each case it's been because an older version of flex was being used. In one of the cases, a version from 2016-Mar-01 was being used, in another it was a version from before 2001-May-01 (?!?).

Everything in these Notes has been tested using flex 2.6.4 in two development environments, with different processor architectures and kernel versions,

```
$ cat /etc/os-release
   PRETTY_NAME="Linux Mint 20.3"
$ uname -a
Linux Hoong 5.4.0-162-generic #179-Ubuntu SMP Mon Aug 14 08:51:31 UTC 2023 x
2023 x86_64 x86_64 x86_64 GNU/Linux
$ flex --version
flex 2.6.4
$ apt-cache policy flex
flex:
  Installed: 2.6.4-6.2
  Candidate: 2.6.4-6.2
  Version table:
*** 2.6.4-6.2 500
   500 http://archive.ubuntu.com/ubuntu focal/main amd64
Packages
   100 /var/lib/dpkg/status
$
```
and

```
$ cat /etc/os-release
PRETTY_NAME="Raspbian GNU/Linux 10 (buster)"
$ uname -a
Linux icywits-01 5.10.103-v7+ #1529 SMP Tue Mar 8 12:21:37 GMT 2022
armv7l GNU/Linux
$ flex --version
flex 2.6.4
$ apt-cache policy flex
flex:
 Installed: 2.6.4-6.2
 Candidate: 2.6.4-6.2
 Version table:
 *** 2.6.4-6.2 500
 500 http://raspbian.raspberrypi.org/raspbian buster/main
armhf Packages
 100 /var/lib/dpkg/status
$
```
That's no guarantee that an error hasn't crept in, though, so report any difficulties you might
encounter, but please, please, please try it with flex 2.6.4 before reporting

# Process

Generally,
• Put all of your flex input in a file named <whatever>.l , as described below.
• Generate the lexical analyzer by executing flex <whatever>.l .
• Include the resulting lex.yy.c file (the generated lexical analyzer) in the build of your entire
program.
Simple, eh?

# Format
The input file for flex should have a .l suffix. flex processes it line-by-line, collects the
information it needs and generates the lex.yy.c lexical analyzer.

flex 's parsing of its input file is quite primitive so it's easy to make a typographical error that
destroys flex 's understanding of what you're trying to do.

Be careful.
Some items have to be on lines by themselves, some items have to start at the left margin (no
whitespace allowed in front), some items must be indented, etc., etc. We try to highlight these
requirements in the following explanations.

One significant issue is flex 's processing of comments. It's safest to stick with C's /* ... */
style of comments. You might get away with // style comments in various places, but it could take
fiddling to figure out how to get flex to accept it. From the flex documentation,
> If you want to follow a simple rule, then always begin a comment on a new line, with
one or more whitespace characters before the initial /* . This rule will work anywhere
in the input file.
The examples all work properly, so you can check their structure, formatting, etc. to see what's
allowed by flex .

# Input File Structure
A .l file is split into three sections and has this general format,
/* Definitions */
%%
/* Rules */
%%
/* User Code /*

The %% marks have to be the only characters on their lines and at the left margin (that is, have no
whitespace in front of them).

# Definitions Section

The *Definitions Section* includes the specification of “definitions” (names for reusable units of regular
expressions) and %option lines (options that control the functioning of flex ). Also included is
any C code the user wants included at the front of the generated lexical analyzer file. This C code is
normally items that will be used by the action routines associated with the patterns given in the Rules
Section.

## Definitions  
flex's regular expression (RE) syntax is from an earlie, simpler age and does not support constructs such as 
* \d
* \s
* \w

**\d** 
decimal digit  
[0-9]

**\s**  
whitespace character  
[ \f\n\r\t\v ]  

**\w**  
"word" character  
[_a-zA-Z0-9]  

etc

> See the Appendix: *flex Regular Expressions* for more details on flex's RE syntax.

